<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="Asciidoctor 1.5.3" name="generator">
<title>Moduł 3: Wstrzykiwanie zależności</title>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<link href="../deck.js/core/deck.core.css" rel="stylesheet">
<link href="../deck.js/extensions/scale/deck.scale.css" media="screen" rel="stylesheet">
<link href="../deck.js/extensions/menu/deck.menu.css" media="screen" rel="stylesheet">
<link href="../deck.js/extensions/navigation/deck.navigation.css" media="screen" rel="stylesheet">
<link href="../deck.js/extensions/status/deck.status.css" media="screen" rel="stylesheet">
<link href="../deck.js/themes/style/swiss.css" media="screen" rel="stylesheet">
<link href="../deck.js/themes/transition/fade.css" media="screen" rel="stylesheet">
<link href="../style.css" rel="stylesheet">
<link href="../deck.js/core/print.css" media="print" rel="stylesheet">
<script src="../deck.js/modernizr.custom.js"></script>
</head>
<body class="article">
<div class="deck-container">
<section class="slide" id="title-slide">
<h1>Moduł 3: Wstrzykiwanie zależności</h1>
</section>
<section class="slide" id="wstrzykiwanie-zależności">
<h2>Wstrzykiwanie zależności</h2>
<div class="ulist">
<ul>
<li>Łączenie komponentów</li>
<li>Kwalifikatory</li>
<li>Wstrzykiwanie zasobów</li>
<li>Wstrzykiwanie wielu instancji komponentu</li>
<li>Stan początkowy komponentu</li>
</ul>
</div>
</section>
<section class="slide" id="adnotacja-autowire">
<h2>Adnotacja @Autowire</h2>
<div class="ulist">
<ul>
<li>Spring posiada mechanizmy automatycznego odnajdywania zależności</li>
<li>Zmniejsza potrzebę jawnego definiowania konfiguracji</li>
<li>Adnotacją można oznaczyć pole, modyfikator lub konstruktor</li>
<li>Framework samodzielnie dopasuje i wybierze komponenty do wstrzyknięcia</li>
</ul>
</div>
</section>
<section class="slide" id="adnotacja-autowire-2">
<h2>Adnotacja @Autowire</h2>
<div class="ulist">
<ul>
<li>Zadziała poprawnie jeżeli framework dopasuje jeden (i tylko jeden) element do wstrzyknięcia</li>
<li>Poprzez atrybut <em>required="false"</em> można ustawić zależność jako opcjonalną</li>
<li>Wstrzykiwanie domyślnie odbywa się po typie komponentu, ale jest to konfigurowalne</li>
<li>Jeżeli w kontekście istnieje więcej niż jeden element możliwy do wstrzyknięcia, konieczne jest bardziej zaawansowane rozwiązywanie zależności</li>
</ul>
</div>
</section>
<section class="slide" id="typy-wstrzykiwania">
<h2>Typy wstrzykiwania</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay nowrap"><code class="xml language-xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">default-autowire</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">byName</span><span class="delimiter">&quot;</span></span> <b class="conum">(1)</b>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Determinuje sposób rozwiązywania zależności</p>
</li>
</ol>
</div>
</section>
<section class="slide" id="typy-wstrzykiwania-2">
<h2>Typy wstrzykiwania (2)</h2>
<table class="tableblock frame-all grid-all" style="width:100%">
<colgroup>
<col style="width:20%">
<col style="width:80%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>no</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Brak mechanizmu autowiring.<br>
Zależności muszą być specyfikowane jawnie</p></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>byName</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Spring wyszukuje zależności na bazie porównywania nazw komponentów i nazw właściwości. np. <em>setGeneraror()</em> → <em>&lt;bean id="generator" /&gt;</em></p></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>byType</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wyszukiwanie zależności następuje po typie, pod warunkiem, że istnieje zdefiniowany tylko jeden komponent danego typu. W przeciwnym razie zostanie zgłoszony wyjątek.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>constructor</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Podobnie jak byType, przy czym ogranicza się tylko i wyłącznie do konstruktorów</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>autodetect</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jeśli dla danej klasy istnieje konstruktor, używana jest strategia constructor, jeśli nie istnieje byType</p></td>
</tr>
</tbody>
</table>
</section>
<section class="slide" id="konfiguracja-xml">
<h2>Konfiguracja XML</h2>
<div class="ulist">
<ul>
<li>Komponenty definiujemy za pomocą tagu <code>&lt;bean /&gt;</code>. Nazwa komponentu (id) musi być unikalna.</li>
<li>Zależności rozwiązywane są poprzez konstruktor bądź modyfikatory (settery)</li>
</ul>
</div>
</section>
<section class="slide" id="konfiguracja-xml-2">
<h2>Konfiguracja XML (2)</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskService</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.todo.TasksService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlMapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlMapClient</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">taskService</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.spring.todo.TasksService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlMapClient</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</section>
<section class="slide" id="więcej-niż-jedna-instancja">
<h2>Więcej niż jedna instancja</h2>
<div class="ulist">
<ul>
<li>Spring umożliwia automatyczne utworzenie list (tablicy) komponentów</li>
<li>Wstrzyknięte zostaną wszystkie komponentu pasujące do danego typu</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="predefined-type">List</span>&lt;TaskPrinter&gt; printers;

<span class="directive">public</span> <span class="type">void</span> print() {
  <span class="keyword">for</span> (TaskPrinter p : printers) {
    p.printCurrentTasks();
  }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="więcej-niż-jedna-instancja-2">
<h2>Więcej niż jedna instancja</h2>
<div class="ulist">
<ul>
<li><p>
Adnotacja @Autowired działa dla:<div class="ulist">
<ul>
<li>artybutów klasy (pól)</li>
<li>setterów</li>
<li>metod</li>
<li>konstruktorów – tylko jeden z konstruktorów może być oznaczony jako required</li>
<li>kolekcji – umieszczane są wszystkie komponenty o danym typie</li>
<li>map – kluczem jest nazwa komponentu a wartością referencja do niego</li>
<li>Interfejsów kontenera – np. <code>ApplicationContext</code></li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide" id="adnotacja-required">
<h2>Adnotacja @Required</h2>
<div class="ulist">
<ul>
<li>Oznacza daną zależność jako wymaganą (dotyczy setterów)</li>
<li>Sprawdzenie następuje w momencie uruchomienia kontenera</li>
<li>Użycie adnotacji <code>@Required</code> jest torżsame z wykorzystaniem atrybuty required dla adnotacji <code>@Autowired</code></li>
</ul>
</div>
</section>
<section class="slide" id="adnotacja-resource">
<h2>Adnotacja @Resource</h2>
<div class="ulist">
<ul>
<li>Wstrzykiwanie zasobów (fabryki BeanFactory, ApplicationContext itp.)</li>
<li>Może zostać wykorzystana do wstrzykiwania komponentów</li>
<li>Wstrzykiwanie przy użyciu @Resource odbywa się po nazwie</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Resource</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">prettyStringTaskPrinter</span><span class="delimiter">&quot;</span></span>)
TaskPrinter p;

<span class="directive">public</span> <span class="type">void</span> print() {
  p.printCurrentTasks();
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="zewnętrzne-pliki-properties">
<h2>Zewnętrzne pliki properties</h2>
<div class="ulist">
<ul>
<li>Spring umożliwia wczytywanie danych z zewnętrznych plików properties</li>
<li>Dane ładowane są w trakcie inicjalizacji aplikacji</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;context:property-placeholder</span>
  <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/dict.properties</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:META-INF/spring/dict.properties</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">JavaConfiguration</span> {
  <span class="annotation">@Bean</span>
  <span class="directive">public</span> PropertySourcesPlaceholderConfigurer properties() {
    <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();
  }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="stan-początkowy-komponentu">
<h2>Stan początkowy komponentu</h2>
<div class="ulist">
<ul>
<li>Do inicjacji komponentu używamy adnotacji <code>@Value</code></li>
<li>Wartość atrybutu można dowolnie zmieniać z poziomu konfiguracji</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Service</span> {
<span class="error"> </span>
  <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${urlStringTemplate}</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> urlStringTemplate;
<span class="error"> </span>
  <span class="comment">//..</span>

}</code></pre>
</div>
</div>
</section>
<section class="slide" id="adnotacja-qualifier">
<h2>Adnotacja @Qualifier</h2>
<div class="ulist">
<ul>
<li>Jeśli komponent posiada więcej niż definicję poprzez adnotację <code>@Qualifier</code> można odwołać się do konkretnej instancji komponentu</li>
<li>W XML analogiczny efekt uzyskujemy atrybutem <code>&lt;qualifier /&gt;</code></li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Autowired</span>(required=<span class="predefined-constant">true</span>)
<span class="directive">public</span> ReportGenerator(
  <span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">repService</span><span class="delimiter">&quot;</span></span>) ReportingService repService) {
  <span class="local-variable">this</span>.reportingService = reportingService;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reportingService</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.springtraining.domain.ReportingService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;qualifier</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">repService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</section>
<section class="slide" id="cykl-życia-komponentu">
<h2>Cykl życia komponentu</h2>
<div class="ulist">
<ul>
<li>Kontener odnajduje definicje komponentów będących singletonami</li>
<li>Następuje inicjacja singletonów</li>
<li><p>
Dla każdego komponentu<div class="ulist">
<ul>
<li>Następuje wstrzykiwanie zależności</li>
<li>Następuje wywołanie metody interfejsu <code>BeanNameAware</code></li>
<li>Następuje wywołanie metody interfejsu <code>ApplicationContextAware</code></li>
<li>Następuje wywołanie metody <code>@PostConstruct</code></li>
<li>Następuje wywołanie metody z interfejsu <code>InitializingBean</code></li>
<li>Następuje wywołanie metody skonfigurowanej z użyciem <code>init-method</code></li>
<li>Następuje wywołanie metody interfejsu <code>BeanPostProcessor</code></li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide" id="cykl-życia-komponentu-2">
<h2>Cykl życia komponentu (2)</h2>
<div class="ulist">
<ul>
<li>Używanie komponentu</li>
<li>Następuje wywołanie metody <code>@PreDestroy</code></li>
<li>Następuje wywołanie metody z interfejsu <code>DisposableBean</code></li>
<li>Następuje wywołanie metody skonfigurowanej z użyciem <code>destroy-method</code></li>
</ul>
</div>
</section>
<section class="slide" id="zdarzenia-applicationcontext">
<h2>Zdarzenia ApplicationContext</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ReportGenerator</span> <span class="directive">implements</span> ApplicationContextAware {

  <span class="directive">public</span> <span class="type">void</span> runReport() {
    ReportEvent reportEvent = <span class="keyword">new</span> ReportEvent(appCtx);
    appCtx.publishEvent(reportEvent);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CompanyDao</span>
  <span class="directive">implements</span> ApplicationListener&lt;ReportEvent&gt; {

  <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(ReportEvent event) {
    <span class="comment">// ...</span>
  }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="standardowe-zdarzenia">
<h2>Standardowe zdarzenia</h2>
<table class="tableblock frame-all grid-all" style="width:100%">
<colgroup>
<col style="width:40%">
<col style="width:60%">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContextRefreshEvent</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> jest inicjowany lub odświeżany (metodą <code>refresh()</code>)</p></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContextStartedEvent</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> został uruchomiony (metoda <code>start()</code>)</p></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContextStoppedEvent</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> został zatrzymany (metoda <code>stop()</code>)</p></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>ContexClosedEvent</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Obiekt <code>ApplicationContext</code> został zakmnięty (metoda <code>close()</code>); wszystkie singletony zostały zniszczone</p></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p><strong>RequestHandleEvent</strong></p></div></div></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Zdarzenie generowane tuż po obsłużeniu żądania HTTP, w przypadku używania dostarczanego przez Spring <code>DispatcherServlet</code></p></div></div></td>
</tr>
</tbody>
</table>
</section>
<section class="slide" id="wsparcie-dla-testów">
<h2>Wsparcie dla testów</h2>
<div class="ulist">
<ul>
<li>Wsparcie dla testów jest od zawsze obecne we frameworku (leżało u jego podstaw)</li>
<li>Zastosowanie wzorca <em>Inversion of Control</em> umożliwia łatwe i wygodne testowanie jednostkowe – wszystkie zależności mogą być rozwiązane ręcznie i nie ma potrzeby implementowania interfejsów</li>
<li>Testowanie od najwcześniejszych etapów wspiera elastyczną architekturę</li>
</ul>
</div>
</section>
<section class="slide" id="testy-integracyjne">
<h2>Testy integracyjne</h2>
<div class="ulist">
<ul>
<li>Adnotacja <code>@RunWith(SpringJUnit4ClassRunner.class)</code> powoduje że test staje się komponentem zarządzanym przez kontener (możliwe jest m.in. wstrzykiwanie zależności)</li>
<li><code>@ContextConfiguration</code> umożliwia wywołanie istniejących konfiguracji (XML, JavaConfig)</li>
</ul>
</div>
</section>
<section class="slide" id="testy-integracyjne-2">
<h2>Testy integracyjne (2)</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@ContextConfiguration</span> <b class="conum">(1)</b>
<span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TranslationCommandValidationTest</span> {

  <span class="annotation">@Autowired</span>
  BeanFactory factory;

  <span class="annotation">@Test</span>
  <span class="directive">public</span> <span class="type">void</span> noAttributesCommand() {
    <span class="comment">//... test method body</span>
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Lista klas używanych w teście (w tym także klasa konfiguracyjna <code>@Configuration</code>)</p>
</li>
</ol>
</div>
</section>
<section class="slide" id="bean-validation-jsr-303">
<h2>Bean Validation – JSR 303</h2>
<div class="ulist">
<ul>
<li>Standard opisu poprawności modelu oraz API do walidacji</li>
<li>Zestaw meta adnotacji opisujących poprawność danych (<code>@NotNull</code>, <code>@Size</code>, <code>@Min</code>, <code>@Max</code> itd.)</li>
<li>Referencyjna implementacja to Hibernate Validator</li>
<li>Spring może korzystać z referencyjnego walidatora, jak też z dostarczanego przez siebie adaptera (implementującego ten sam interfejs)</li>
</ul>
</div>
</section>
<section class="slide" id="bean-validation-jsr-303-2">
<h2>Bean Validation – JSR 303 (2)</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Employee</span> {

  <span class="annotation">@NotNull</span>
  <span class="annotation">@Size</span>(min = <span class="integer">5</span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> name;

  <span class="annotation">@NotNull</span>
  <span class="annotation">@Size</span>(min = <span class="integer">10</span>)
  <span class="directive">private</span> <span class="predefined-type">String</span> address;

  <span class="annotation">@Past</span>
  <span class="directive">private</span> <span class="predefined-type">Date</span> birthdate;

  <span class="comment">//..</span>
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="bean-validation-jsr-303-3">
<h2>Bean Validation – JSR 303 (3)</h2>
<div class="ulist">
<ul>
<li>Dostęp do walidatora odbywa się przez <code>ValidationFactory</code></li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java">Employee employee = <span class="keyword">new</span> Employee();
employee.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>);
employee.setAddress(<span class="string"><span class="delimiter">&quot;</span><span class="content">Lodz</span><span class="delimiter">&quot;</span></span>);

ValidatorFactory validationFactory =
  Validation.buildDefaultValidatorFactory();
<span class="predefined-type">Validator</span> validator = validationFactory.getValidator();

<span class="predefined-type">Set</span>&lt;ConstraintViolation&lt;Employee&gt;&gt; constraints =
  validator.validate(employee); <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Lista błędów walidacji</p>
</li>
</ol>
</div>
</section>
<section class="slide" id="bean-validation-jsr-303-4">
<h2>Bean Validation – JSR 303 (4)</h2>
<div class="ulist">
<ul>
<li><p>
Metoda <code>validate()</code> sprawdza poprawność klasy<div class="ulist">
<ul>
<li><em>object</em> – obiekt do walidacji</li>
<li><em>groups</em> – grupa (lub lista grup) walidacyjnych</li>
</ul>
</div></p></li>
<li><p>
Grupa walidacyjna pozwala zawęzić zakres walidacji, tylko do pewnego podzbioru ograniczeń<div class="ulist">
<ul>
<li>Jest to pusty interfejs</li>
<li>Domyślna grupa walidacyjna to <code>javax.validation.groups.Default</code></li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide" id="bean-validation-jsr-303-5">
<h2>Bean Validation – JSR 303 (5)</h2>
<div class="imageblock">
<div class="content">
<img alt="annotatiomania" src="../images/annotatiomania.png">
</div>
</div>
</section>
<section class="slide" id="bean-validation-spring">
<h2>Bean Validation - Spring</h2>
<div class="paragraph lead"><p>Komponent LocalValidationFactoryBean można bezpośrednio użyć w aplikacji Spring</p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bean</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> LocalValidatorFactoryBean validator() {
  <span class="keyword">return</span> <span class="keyword">new</span> LocalValidatorFactoryBean();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validator</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">o.s.v.beanvalidation.LocalValidatorFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</section>
<section class="slide" id="bean-validation-spring-2">
<h2>Bean Validation - Spring</h2>
<div class="paragraph lead"><p>Zainicjowany walidator możemy wstrzyknąć jako komponent</p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">Validator</span> validator;

<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;ConstraintViolation&lt;Param&gt;&gt; validate(Param p) {
  <span class="keyword">return</span> validator.validate(p, SearchValidationGroup.class);
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="własny-walidator">
<h2>Własny walidator</h2>
<div class="ulist">
<ul>
<li>Tworzymy adnotację na bazie adnotacji <code>@Constraint</code></li>
<li>Implementujemy interfejs <code>ConstraintValidator</code></li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@NameFormatting</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

  <span class="comment">//...</span>

}</code></pre>
</div>
</div>
</section>
<section class="slide" id="własny-walidator-2">
<h2>Własny walidator</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Target</span>( { <span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.FIELD, <span class="predefined-type">ElementType</span>.TYPE })
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Constraint</span>(validatedBy = NameFormattingValidator.class)
<span class="directive">public</span> <span class="annotation">@interface</span> NameFormatting {
  <span class="predefined-type">String</span> message() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">{c.e.constraints.nameFormatting}</span><span class="delimiter">&quot;</span></span>;

  <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> groups() <span class="keyword">default</span> {};

  <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> Payload&gt;<span class="type">[]</span> payload() <span class="keyword">default</span> {};

}</code></pre>
</div>
</div>
</section>
<section class="slide" id="własny-walidator-3">
<h2>Własny walidator</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">NameFormattingValidator</span> <span class="directive">implements</span>
  ConstraintValidator&lt;NameFormatting, Author&gt; {

  <span class="directive">public</span> <span class="type">boolean</span> isValid(Author author,
    ConstraintValidatorContext context) {
    <span class="keyword">if</span> (author == <span class="predefined-constant">null</span>) <span class="keyword">return</span> <span class="predefined-constant">true</span>; <b class="conum">(1)</b>

    <span class="comment">//... dalsza logika walidacji</span>

    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
  }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="błędy-walidacji">
<h2>Błędy walidacji</h2>
<div class="ulist">
<ul>
<li>Błędy walidacji przechowywane są w strukturze implementującej interfejs <code>ConstrainViolation</code></li>
<li>Zwyczajowo błędy raportowane są za pomocą klucza: [nazwa_błedu].[obiekt].[atrybut_obiektu] np.: <code>Future.task.date</code></li>
<li>Wartością jest domyślny opis błędu</li>
<li>Opisy błędu można z łatwością definiować i lokalizować wykorzystując mechanizm <code>ResourceBundles</code> i <code>MessageSource</code></li>
</ul>
</div>
</section>
<section class="slide" id="legacy-spring-validation">
<h2>Legacy Spring Validation</h2>
<div class="paragraph lead"><p>Podstawowy interfejs <code>Validator</code> do tworzenia obiektów walidujących klasy modelu</p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Validator</span> {

  <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; arg0);

  <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> arg0, Errors arg1);

}</code></pre>
</div>
</div>
</section>
<section class="slide" id="legacy-spring-validation-2">
<h2>Legacy Spring Validation</h2>
<div class="paragraph lead"><p>Przykładowa implementacja</p></div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> {

  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_NAME_LENGHT = <span class="integer">30</span>;
  <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> MAX_ADDRESS_LENGHT = <span class="integer">80</span>;

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; clazz) {
    <span class="keyword">return</span> Employee.class.equals(clazz);
  }

  <span class="comment">//...</span></code></pre>
</div>
</div>
</section>
<section class="slide" id="legacy-spring-validation-3">
<h2>Legacy Spring Validation</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="comment">//...</span>

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> object, Errors e) {
    ValidationUtils.rejectIfEmpty(e, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.empty</span><span class="delimiter">&quot;</span></span>);
    ValidationUtils.rejectIfEmpty(e, <span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">address.empty</span><span class="delimiter">&quot;</span></span>);

    Employee employee = (Employee) object;

    <span class="keyword">if</span> ( employee.getName().length() &gt; MAX_NAME_LENGHT ) {
      e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name.tooLong</span><span class="delimiter">&quot;</span></span>);
    }
    <span class="comment">//...</span>
  }
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="legacy-spring-validation-4">
<h2>Legacy Spring Validation</h2>
<div class="paragraph lead"><p>Klasa <code>Errors</code></p></div>
<div class="ulist">
<ul>
<li>Reprezentuje i przechowuje informacje na temat błędów związanych z walidacją</li>
<li>Umożliwia zarejestrowanie błędów dla obiektu lub pojedynczego pola</li>
<li><p>
Najważniejsze metody<div class="ulist">
<ul>
<li><em>reject(String errorCode [,String defaultMessage])</em><br>
zarejestruje błąd dla całego obiektu; errorCode oznacza klucz błędu w <code>Properties</code></li>
<li>_rejectValue(String field, String errorCode, [String defaultMessage])<br>
rejestruje błąd dla pojedynczego pola</li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide" id="legacy-spring-validation-5">
<h2>Legacy Spring Validation</h2>
<div class="paragraph lead"><p>Klasa <code>ValidationUtils</code></p></div>
<div class="ulist">
<ul>
<li>Pomocnicza klasa walidacyjna</li>
<li>Waliduje czy w obiekcie, pole nie jest puste</li>
<li>Działa na obiekcie typu Errors</li>
<li><p>
Najważniejsze metody<div class="ulist">
<ul>
<li><em>rejectIfEmpty(Errors errors, String field, String errorCode [,String defaultMessage])</em><br>
zarejestruje błąd dla całego obiektu, jeśli pole jest puste</li>
<li><em>rejectIfEmptyOrWhitespce(Errors errors, String field, String errorCode [,String defaultMessage])</em><br>
zarejestruje błąd dla całego obiektu, jeśli pole jest puste lub składa się tylko z białych znaków</li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide" id="lokalizacja-em-i18n-em">
<h2>Lokalizacja – <em>i18n</em></h2>
<div class="ulist">
<ul>
<li><p>
Dodanie do konfiguracji komponentu MessageSource <em>informuje</em> framework o istnieniu wersji językowych<div class="ulist">
<ul>
<li>Atrybut <code>basename</code> wskazuje lokalizację pliku z tłumaczeniami</li>
<li>Dla każdego kolejnego języka dodawana jest odpowiednia końcówka (<code>message_pl.properties</code>)</li>
</ul>
</div></p></li>
</ul>
</div>
</section>
<section class="slide" id="lokalizacja-aplikacji">
<h2>Lokalizacja aplikacji</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource”</span>
  <span class="content">class=</span><span class="delimiter">&quot;</span></span><span class="attribute-name">o.s.c.support.ReloadableResourceBundleMessageSource</span><span class="error">&quot;</span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basename</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:messages</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultEncoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">public</span> ResourceBundleMessageSource messageSource() {
  ResourceBundleMessageSource messageSource =
          <span class="keyword">new</span> ResourceBundleMessageSource();
  messageSource.setBasename(<span class="string"><span class="delimiter">&quot;</span><span class="content">messages</span><span class="delimiter">&quot;</span></span>);
  messageSource.setDefaultEncoding(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>);
  <span class="keyword">return</span> messageSource;
}</code></pre>
</div>
</div>
</section>
<section class="slide" id="lokalizacja-aplikacji-3">
<h2>Lokalizacja aplikacji (3)</h2>
<div class="ulist">
<ul>
<li>Aby skorzystać z i18n potrzebujemy dostęp do obiektu <code>ApplicationContext</code> lub <code>MessageSource</code></li>
<li>Wygodną metodą jest wstrzyknięcie <code>MessageSource</code> do klasy</li>
<li>Metoda <code>getMessage(String key, Object[] args, Locale locale)</code> służy do pobrania odpowiedniej wersji komunikatu</li>
<li>Mechanizm ten może być używany zarówno w walidacji i jak i całkowicie niezależnie</li>
<li>Używany jest w Spring MVC</li>
</ul>
</div>
</section>
<section class="slide" id="lokalizacja-aplikacji-4">
<h2>Lokalizacja aplikacji (4)</h2>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ValidationService</span> {
  <span class="directive">private</span> MessageSource messageSource;

  <span class="directive">public</span> <span class="type">void</span> validate(Employee object) {
    <span class="comment">//... validate object</span>
    <span class="keyword">for</span> (ConstraintViolation&lt;Employee&gt; fieldError : errors) {
      <span class="predefined-type">String</span> field = fieldError.getPropertyPath();
      <span class="predefined-type">String</span> code = fieldError.getMessageTemplate();

      <span class="predefined-type">Locale</span> locale = <span class="keyword">new</span> <span class="predefined-type">Locale</span>( <span class="string"><span class="delimiter">&quot;</span><span class="content">pl</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">PL</span><span class="delimiter">&quot;</span></span> );
      messageSource.getMessage(code, <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{}, locale);
    }
  }
}</code></pre>
</div>
</div>
</section>
<div aria-role="navigation">
<a class="deck-prev-link" href="#" title="Previous">&#8592;</a>
<a class="deck-next-link" href="#" title="Next">&#8594;</a>
</div>
<p aria-role="status" class="deck-status">
<span class="deck-status-current"></span>
/
<span class="deck-status-total"></span>
</p>
</div>
<script src="../deck.js/jquery.min.js"></script>
<script src="../deck.js/core/deck.core.js"></script>
<script src="../deck.js/extensions/scale/deck.scale.js"></script>
<script src="../deck.js/extensions/menu/deck.menu.js"></script>
<script src="../deck.js/extensions/navigation/deck.navigation.js"></script>
<script src="../deck.js/extensions/status/deck.status.js"></script>
<script>
  (function($, deck, undefined) {
    $.deck.defaults.keys['previous'] = [8, 33, 37, 39];
    $.deck.defaults.keys['next'] = [13, 32, 34, 39];
  
    $.extend(true, $[deck].defaults, {
        countNested: false
    });
  
    $.deck('.slide');
  })(jQuery, 'deck');
</script>
<style>
  .slide.canvas-image {
  -moz-background-size: cover;
  -webkit-background-size: cover;
  -o-background-size: cover;
  background-size: cover;
  display: -moz-box;
  display: -webkit-box;
  display: -ms-box;
  display: box;
  -moz-box-orient: vertical;
  -webkit-box-orient: vertical;
  -ms-box-orient: vertical;
  box-orient: vertical;
  -moz-box-align: start;
  -webkit-box-align: start;
  -ms-box-align: start;
  box-align: start;
  -moz-box-pack: start;
  -webkit-box-pack: start;
  -ms-box-pack: start;
  box-pack: start;}
  
  .bottom-left {
    left: 1%;
    bottom: 20%; }
  
  .top-left {
    left: 1%;
    top: 20%; }
  
  .bottom-right {
    right: 1%;
    bottom: 20%; }
  
  .top-right {
    right: 1%;
    top: 20%; }
  
  .center-up {
    right: 50%;
    top: 1%;
  }
  
  .center-down {
    right: 50%;
    bottom: 1%;
  }
  .canvas-image .canvas-caption p {
    text-align: center;
    padding-top: 0;
    padding: 0;
    -moz-transform: none;
    -webkit-transform: none;
    -o-transform: none;
    -ms-transform: none;
    transform: none;
    display: inline;
    position: absolute;
    background-color: rgba(0, 0, 0, 0.7);
    font-weight: bold;
    font-size: 58px;
    -webkit-box-shadow: 2px 2px 2px #000;
    -moz-box-shadow: 2px 2px 2px #000;
    box-shadow: 2px 2px 2px #000;
    padding: 1rem;
    color: white; }
  kbd.keyseq { color: #555555; }
  kbd:not(.keyseq) {
    display: inline-block;
    color: #222222;
    font-size: 0.7em;
    line-height: 1.4;
    background-color: #F7F7F7;
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    margin: -0.15em 0.15em 0 0.15em;
    padding: 0.2em 0.6em;
    vertical-align: middle;
    white-space: nowrap;
  }
  kbd kbd:first-child { margin-left: 0; }
  kbd kbd:last-child { margin-right: 0; }
</style>
</body>
</html>